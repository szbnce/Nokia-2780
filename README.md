# Nokia-2780
Documentation and files about/for repairing Nokia 2780 Flip

# Start
Well, I never wrote documentation, so I'm sorry in advance for anything that I mess up.
If you want to know about me more, check [my GitHub profile](https://github.com/szbnce)

# Backstory
This documentation is going to be extremly long since everything I find and know about this device will be
dumped here, mostly into this README, but I'm planning to make a straight forward documentation about it [here](https://github.com/szbnce/Nokia-2780/blob/main/STRAIGHTFORWARD.md) and [Bananahackers](https://bananahackers.net)

I always wanted a KaiOS device, since I wondered about what it was like, a new "dumb" phone, I was/am already pretty used to the old Nokia and other retro devices, since I have repair and collect these phones, so I decided to ask around, what it was like, and luckily, one of my great friends had one, but it wasn't working. He said that he'll give it to me for free but I have to repair it. It booted into weeknd-toolbox,  but it was not booting into the system, rather after the "Enabled by KaiOS" screen, it booted into EDL. Hmm, what could be the problem? The only modified partitions on the phone were recovery, avb_custom_key and vbmeta. It must be that AVB (Android Verified Boot) fails, and goes into EDL. Must be easy to fix, right? Just flash the stock vbmeta and recovery and you are good to go. Or are you? The phone does not have the stock firmware online, no EDL SW, no fastboot flashable SW. What can I do with this device? Well, I was looking around, and something caught my eye on the Bananahackers weeknd-toolbox tutorial page (when I get around to searching it I'll edit it). It had the stock vbmeta. Huh, nice. I'll flash it and it will be good to go. The problem that it was not good to go, since after flashing just the vbmeta image, it displayed that the phone's software is corrupted and can not be trusted. So the vbmeta is good to go, but the recovery prevented the use of the phone. And after looking at the page once again carefully, I found the stock recovery aswell. Nice. I flashed it, and the phone now works. I used it for a few days, stock, as any normal people would. But I'm not normal. The voices in the back of my head said that I should mod this phone, install some apps and try to use this phone as my daily driver for a few days. So I started doing it. I installed Manjaro in a VM (I'm lazy to free up space on my pc again), set up the android development enviroment, cloned weeknd-toolbox, and started building it. But I had a problem again, the repo was not updated, so if it wasn't working before, why should it now? I started looking into the problem, since the phone could not be bootloader unlocked, and the only thing that makes this phone moddable is that there is a flaw in fastboot, a command, "fastboot oem sudo" that grants flashing files and partitions that are not allowed. And since the bootloader can't be turned off, AVB can't be either, so to flash anything other than the unobtainable stock firmware, you have to sign the partitions, and flash the Public Key Metadata to avb_custom_key, you have to build your very own vbmeta with avbtool, and flash the correctly hashed image file to the partition, and the phone would be able to boot the custom software, after a warning at boot that the phone is running custom firmware. Well, it was hard, I won't go into much detail, but after around 3 rebuilds, 150 fastboot flashing, and around 500 commands ran, I finally realized the issue, fixed it, and pushed the working [weeknd-toolbox](https://github.com/szbnce/weeknd-toolbox) to my GitHub. Shortly, the key in Affe Null's official version was SHA512_RSA2048, in my version it is SHA256_4096, and I replaced the stock-vbmeta.img in Affe Null's version to the one I found on Bananahackers, and I enabled debugging in lk2nd. After these changes, the phone booted correctly both into the system and weeknd-recovery. I started the enabling of ADB, but it wasn't quite working as it shouldve. I had to fix the system partition with e2ck, some partitions were unwriteable. I decided, before I try to do any bold thing, I should fully back up the emmc, but in the process, when I wanted to start it, and the whole emmc was connected to my pc, the battery fell out of my device. After this, the phone didn't turn on, after connecting the charger, it instantly goes into Qualcomm HS-USB Diagnostics 900E, basically download mode (in QFIL/QPST it shows download mode). Right now, my current guess is, that the emmc is stuck in mass-storage, and the phone can't recognize it. I do not have the firehose for the device, I'm actively searching for it. Somebody in r/KaiOS Reddit/Discord said they have a half working emmc backup, when I get it I will make sure to check it out, what can I do with this.

---

# I want to help
If you are willing to help with anything related to this, feel free to dm me on Telegram (@szbnce) and on Discord (@szbnce)

# Credits
Bence Szab√≥